<?php
function wcfFormatTimeImpl($format, $time, $offset = 'auto') {
	static $l;
	if(empty($format)) return '';
	if(!is_array($l)) {
		$l = array(
			'ru' => array(
				array('$01', '$02', '$03', '$04', '$05', '$06', '$07', '$08', '$09', '$10', '$11','$12', '&0', '&1', '&2', '&3', '&4', '&5', '&6', '@0', '@1', '@2', '@3', '@4', '@5', '@6'),
				array('января', 'февраля', 'марта', 'апреля', 'мая', 'июня', 'июля', 'августа', 'сентября', 'октября', 'ноября', 'декабря', 'воскресенье', 'понедельник', 'вторник', 'среда', 'четверг', 'пятница', 'суббота', 'вс', 'пн', 'вт', 'ср', 'чт', 'пт', 'сб')
			),
			'Ru' => array(
				array('$01', '$02', '$03', '$04', '$05', '$06', '$07', '$08', '$09', '$10', '$11','$12', '&0', '&1', '&2', '&3', '&4', '&5', '&6', '@0', '@1', '@2', '@3', '@4', '@5', '@6'),
				array('Января', 'Февраля', 'Марта', 'Апреля', 'Мая', 'Июня', 'Июля', 'Августа', 'Сентября', 'Октября', 'Ноября', 'Декабря', 'Воскресенье', 'Понедельник', 'Вторник', 'Среда', 'Четверг', 'Пятница', 'Суббота', 'Вс', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб')
			),
			'uz' => array(
				array('$01', '$02', '$03', '$04', '$05', '$06', '$07', '$08', '$09', '$10', '$11','$12', '&0', '&1', '&2', '&3', '&4', '&5', '&6', '@0', '@1', '@2', '@3', '@4', '@5', '@6'),
				array('январ', 'феврал', 'март', 'апрел', 'май', 'июн', 'июл', 'август', 'сентябр', 'октябр', 'ноябр', 'декабр', 'якшанба', 'душанба', 'сешанба', 'чоршанба', 'пайшанба', 'жума', 'шанба', 'ysh', 'dsh', 'ssh', 'chs', 'psh', 'jum', 'shb')
			),
			'Uz' => array(
				array('$01', '$02', '$03', '$04', '$05', '$06', '$07', '$08', '$09', '$10', '$11','$12', '&0', '&1', '&2', '&3', '&4', '&5', '&6', '@0', '@1', '@2', '@3', '@4', '@5', '@6'),
				array('Январ', 'Феврал', 'Март', 'Апрел', 'Май', 'Июн', 'Июл', 'Август', 'Сентябр', 'Октябр', 'Ноябр', 'Декабр', 'Якшанба', 'Душанба', 'Сешанба', 'Чоршанба', 'Пайшанба', 'Жума', 'Шанба', 'Ysh', 'Dsh', 'Ssh', 'Chs', 'Psh', 'Jum', 'Shb')
			),					
		);
	}
	if($offset) {
		if(!is_int($offset)) {
			if($offset == 'server')
				$offset = date('Z');
			elseif($offset == 'site')
				$offset = WC_TIMEZONE;
			elseif($offset == 'auto')
				$offset = date('Z') - WC_TIMEZONE;
			else
				$offset = 0;
		} else
			$offset = (int) $offset;
	} else
		$offset = 0;
	if($format{0} == '@' && isset($l[$lng = substr($format, 1, 2)])) {
		$result = date(strtr(utf8_substr($format, 3), array('F' => '$m', 'l' => '&w', 'D' => '@w')), $time - $offset);
		return str_replace($l[$lng][0], $l[$lng][1], $result);
	} else
		return date($format, $time - $offset);
}
?>
